{"version":3,"file":"js/541.bd213c7d.js","mappings":"ozCAqFA,MAAMA,GAASC,EAAAA,EAAAA,MACTC,GAAQC,EAAAA,EAAAA,MACRC,GAAaC,EAAAA,EAAAA,IAAI,QACjBC,GAAUD,EAAAA,EAAAA,KAAI,GAEdE,EAAkBA,CAACC,EAAMC,EAAOC,KACpC,IAAKD,EACH,OAAOC,EAAS,IAAIC,MAAM,YAE5BC,EAAAA,EAAAA,IAAc,CAAEC,KAAMJ,IAASK,MAAKC,GAC9BA,GAAoB,MAAbA,EAAIF,KACNH,IAEAA,EAAS,IAAIC,MAAM,WAE5B,EAGEK,GAAcX,EAAAA,EAAAA,IAAI,MAClBY,GAAgBC,EAAAA,EAAAA,IAAS,CAC7BC,KAAM,CACJ,CAAEC,UAAU,EAAMC,QAAS,SAAUC,QAAS,SAEhDC,IAAK,CACH,CAAEH,UAAU,EAAMC,QAAS,QAASC,QAAS,SAE/CE,QAAS,CACP,CAAEC,UAAWlB,EAAiBe,QAAS,WAGrCI,GAAWrB,EAAAA,EAAAA,IAAI,CACnBc,KAAM,GACNI,IAAK,GACLC,QAAS,KAGLG,GAAetB,EAAAA,EAAAA,IAAI,MACnBuB,EAAaA,CAACpB,EAAMC,EAAOC,IAC1BD,EAGA,oBAAoBoB,KAAKpB,QAG9BC,IAFSA,EAAS,IAAIC,MAAM,cAHnBD,EAAS,IAAIC,MAAM,WAOxBmB,GAAiBZ,EAAAA,EAAAA,IAAS,CAC9Ba,MAAO,CACL,CAAEN,UAAWG,EAAYN,QAAS,SAEpCT,KAAM,CACJ,CAAEO,UAAU,EAAMC,QAAS,SAAUC,QAAS,WAG5CU,GAAY3B,EAAAA,EAAAA,IAAI,CACpB0B,MAAO,GACPlB,KAAM,KAGFoB,GAAY5B,EAAAA,EAAAA,IAAI,GAChB6B,GAAQ7B,EAAAA,EAAAA,IAAI,MACZ8B,EAAiBA,KACrBF,EAAUxB,MAAQ,GAClByB,EAAMzB,MAAQ2B,aAAY,KACpBH,EAAUxB,MAAQ,EACpBwB,EAAUxB,SAEV4B,cAAcH,EAAMzB,OACpByB,EAAMzB,MAAQ,KAChB,GACC,IAAK,EAGJ6B,GAAajC,EAAAA,EAAAA,IAAI,IACjBkC,EAAgBC,UACpB,IAAIzB,QAAY0B,EAAAA,EAAAA,MACZ1B,GAAoB,MAAbA,EAAIF,OACbyB,EAAW7B,MAAQM,EAAI2B,KAAKlB,QAC9B,EAGImB,EAAcA,KACO,SAArBvC,EAAWK,MACbO,EAAYP,MAAMmC,UAASJ,UACzB,GAAIK,EAAO,CACT,IAAI9B,QAAY+B,EAAAA,EAAAA,IAAQpB,EAASjB,OAC7BM,GAAoB,MAAbA,EAAIF,OACbkC,OAAOC,SAASC,KAAOC,aAAaC,QAAQ,YAEhD,KAGFxB,EAAalB,MAAMmC,UAASC,IACtBA,GACFO,QAAQC,IAAIrB,EAAUvB,MAAO,QAC/B,GAEJ,EAEI6C,EAAcA,OAGdC,GAAYlD,EAAAA,EAAAA,KAAI,GAChBmD,GAAWnD,EAAAA,EAAAA,IAAI,QACfoD,EAAejB,UACnBgB,EAAS/C,MAAQ,SACjB8C,EAAU9C,OAAQ,EAClB,MAAMM,QAAY2C,EAAAA,EAAAA,MAClB,GAAgB,MAAb3C,EAAIF,KAAc,CACnB,IAAI8C,EAAS,CACXC,GAAI,UACJC,MAAO9C,EAAI2B,KAAKoB,MAChBC,QAAShD,EAAI2B,KAAKsB,QAClBC,aAAclD,EAAI2B,KAAKwB,YACvBC,MAAQpD,EAAI2B,KAAKyB,MACjBC,MAAOrD,EAAI2B,KAAK0B,OAElB,IAAIC,QAAQV,GACZJ,EAAU9C,OAAQ,CACpB,GAEI6D,EAAiBA,KACrBtE,EAAOuE,KAAK,kBAAkB,EAE1BC,EAAgBA,KACf,oBAAoB3C,KAAKG,EAAUvB,MAAMsB,OAItB,IAApBE,EAAUxB,OACZ0B,IAJAsC,EAAAA,GAAUC,MAAM,YAKlB,E,OAEFC,EAAAA,EAAAA,KAAcnC,UACZ,IAAIoC,EAAW1E,EAAM2E,MAAMC,iBAAmB,cAAgB5E,EAAM2E,MAAME,UAAY,kBAAoB7E,EAAM2E,MAAMG,cAAgB,iBAAmB9E,EAAM2E,MAAMZ,aACrKf,aAAa+B,QAAQ,WAAYL,GAEjC,IAAIM,EAAKnC,OAAOoC,UAAUC,UAAUC,cACpC,GAAIH,EAAGI,MAAM,WAAY,CACvB,IAAIvE,QAAYwE,EAAAA,EAAAA,MAChB,GAAiB,MAAbxE,EAAIF,KAEN,YADAkC,OAAOC,SAASC,KAAOlC,EAAI2B,KAG/B,CAEA,IAAI3B,QAAYyE,EAAAA,EAAAA,MACZzE,EAAI2B,OACFxC,EAAM2E,MAAMT,QACdQ,GAAY,UAAY1E,EAAM2E,MAAMT,MACpClB,aAAa+B,QAAQ,WAAYL,IAEnC7B,OAAOC,SAASC,KAAO2B,GAEzBtE,EAAQG,OAAQ,EAChB8B,GAAe,KAEjBkD,EAAAA,EAAAA,KAAgB,KACdpD,cAAcH,EAAMzB,MAAM,I,ysGC7O5B,MAAMiF,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://ruifox-oauth2/./src/views/login/LoginHome.vue","webpack://ruifox-oauth2/./src/views/login/LoginHome.vue?2986"],"sourcesContent":["<template>\r\n  <div class=\"login-home\" v-loading=\"loading\" element-loading-text=\"系统加载中...\" :fullscreen=\"true\">\r\n    <div class=\"login-box\">\r\n      <div class=\"login-header\">\r\n        <img src=\"@/assets/favicon.png\" alt=\"\">\r\n      </div>\r\n      <div class=\"login-body\">\r\n        <div class=\"login-form\" v-if=\"loginWay === 'form'\">\r\n          <div class=\"form-body\">\r\n            <el-tabs v-model=\"activeName\">\r\n              <el-tab-pane name=\"user\">\r\n                <template #label>\r\n                  <div class=\"tab-label\">\r\n                    <i class=\"iconfont\">&#xe6e3;</i>账户密码登录\r\n                  </div>\r\n                </template>\r\n                <el-form :model=\"userForm\" :rules=\"userFormRules\" ref=\"userFormRef\">\r\n                  <el-form-item prop=\"name\">\r\n                    <el-input v-model=\"userForm.name\" type=\"text\" size=\"large\" placeholder=\"请输入用户名\" />\r\n                  </el-form-item>\r\n                  <el-form-item prop=\"pwd\">\r\n                    <el-input v-model=\"userForm.pwd\" type=\"password\" size=\"large\" placeholder=\"请输入密码\" />\r\n                  </el-form-item>\r\n                  <el-form-item prop=\"captcha\" class=\"captcha\">\r\n                    <el-input v-model=\"userForm.captcha\" type=\"text\" size=\"large\" placeholder=\"请输入验证码\" />\r\n                    <img :src=\"picCaptcha\" alt=\"\" class=\"captcha-item\" @click=\"getPicCaptcha\">\r\n                  </el-form-item>\r\n                </el-form>\r\n              </el-tab-pane>\r\n              <el-tab-pane name=\"phone\">\r\n                <template #label>\r\n                  <div class=\"tab-label\">\r\n                    <i class=\"iconfont\">&#xe654;</i>手机验证码登录\r\n                  </div>\r\n                </template>\r\n                <el-form :model=\"phoneForm\" :rules=\"phoneFormRules\" ref=\"phoneFormRef\">\r\n                  <el-form-item prop=\"phone\">\r\n                    <el-input v-model=\"phoneForm.phone\" type=\"text\" size=\"large\" placeholder=\"请输入手机号\" />\r\n                  </el-form-item>\r\n                  <el-form-item prop=\"code\" class=\"form-code\">\r\n                    <el-input v-model=\"phoneForm.code\" type=\"text\" size=\"large\" placeholder=\"请输入验证码\" />\r\n                    <el-button size=\"large\" @click=\"handleGetCode\" :disabled=\"countdown > 0\">\r\n                      {{ countdown > 0 ? countdown + '秒后重新获取' : '获取验证码' }}\r\n                    </el-button>\r\n                  </el-form-item>\r\n                </el-form>\r\n              </el-tab-pane>\r\n            </el-tabs>\r\n          </div>\r\n          <div class=\"form-btn\">\r\n            <el-button type=\"primary\" size=\"large\" @click=\"handleLogin\">登录</el-button>\r\n          </div>\r\n          <div class=\"form-footer\" v-if=\"activeName !== 'phone'\">\r\n            <el-button link type=\"primary\" @click=\"handleFoget\">忘记密码</el-button>\r\n            <el-button link type=\"primary\" @click=\"handleRegister\">注册账户</el-button>\r\n          </div>\r\n        </div>\r\n        <div class=\"login-qrcode\" v-else v-loading=\"qrLoading\">\r\n          <div id=\"qr_code\"></div>\r\n        </div>\r\n        <el-popover v-if=\"loginWay === 'form'\" placement=\"right\" :width=\"150\" trigger=\"hover\" popper-class=\"my-popper\">\r\n          <template #reference>\r\n            <div class=\"change-way-btn\"><i class=\"iconfont\">&#xe608;</i></div>\r\n          </template>\r\n          <div class=\"option-list\">\r\n            <div class=\"option-item\" style=\"padding-left: 20px;cursor: pointer;color: #4D99F2;\" @click=\"handleWechat\"><i class=\"iconfont\">&#xe658;</i>企业微信</div>\r\n          </div>\r\n        </el-popover>\r\n        <div class=\"change-way-btn\" v-if=\"loginWay === 'qrcode'\"><i class=\"iconfont\" @click=\"loginWay = 'form'\">&#xe698;</i></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"login-footer\">\r\n    <div class=\"copyright\">锐狐科技有限公司</div>\r\n    <div class=\"copyright\">© 2006-2023 ruifox.com 版权所有 蜀ICP备07001898号-1   川公网安备：51010402000199号</div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n/* eslint-disable */\r\nimport { ElMessage } from 'element-plus'\r\nimport { ref, reactive, onBeforeUnmount, onBeforeMount, onMounted } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { doLogin, generateCaptcha, verifyCaptcha, isLogin, getBaseUrl, getNativeBaseUrl, getCodeRender } from '@/api/login'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst activeName = ref('user')\r\nconst loading = ref(true)\r\n//图片验证码判断\r\nconst picCaptchaValid = (rule, value, callback) => {\r\n  if (!value) {\r\n    return callback(new Error('请输入验证码'))\r\n  }\r\n  verifyCaptcha({ code: value }).then(res => {\r\n    if (res && res.code === 200) {\r\n      return callback()\r\n    } else {\r\n      return callback(new Error('验证码错误'))\r\n    }\r\n  })\r\n}\r\n//账户密码登录\r\nconst userFormRef = ref(null)\r\nconst userFormRules = reactive({\r\n  name: [\r\n    { required: true, message: '请输入用户名', trigger: 'blur' }\r\n  ],\r\n  pwd: [\r\n    { required: true, message: '请输入密码', trigger: 'blur' }\r\n  ],\r\n  captcha: [\r\n    { validator: picCaptchaValid, trigger: 'blur' }\r\n  ]\r\n})\r\nconst userForm = ref({\r\n  name: '',\r\n  pwd: '',\r\n  captcha: ''\r\n})\r\n//手机验证码登录\r\nconst phoneFormRef = ref(null)\r\nconst phoneValid = (rule, value, callback) => {\r\n  if (!value) {\r\n    return callback(new Error('请输入手机号'))\r\n  }\r\n  if (!/^1[3456789]\\d{9}$/.test(value)) {\r\n    return callback(new Error('请输入正确的手机号'))\r\n  }\r\n  callback()\r\n}\r\nconst phoneFormRules = reactive({\r\n  phone: [\r\n    { validator: phoneValid, trigger: 'blur' }\r\n  ],\r\n  code: [\r\n    { required: true, message: '请输入验证码', trigger: 'blur' }\r\n  ]\r\n})\r\nconst phoneForm = ref({\r\n  phone: '',\r\n  code: ''\r\n})\r\n//验证码计时器\r\nconst countdown = ref(0)\r\nconst timer = ref(null)\r\nconst startCountdown = () => {\r\n  countdown.value = 60;\r\n  timer.value = setInterval(() => {\r\n    if (countdown.value > 0) {\r\n      countdown.value--;\r\n    } else {\r\n      clearInterval(timer.value);\r\n      timer.value = null;\r\n    }\r\n  }, 1000);\r\n}\r\n//图片验证码\r\nconst picCaptcha = ref('')\r\nconst getPicCaptcha = async () => {\r\n  let res = await generateCaptcha()\r\n  if (res && res.code === 200) {\r\n    picCaptcha.value = res.data.captcha\r\n  }\r\n}\r\n//登录（需准备授权信息带入授权页面）\r\nconst handleLogin = () => {\r\n  if (activeName.value === 'user') {\r\n    userFormRef.value.validate(async (valid) => {\r\n      if (valid) {\r\n        let res = await doLogin(userForm.value)\r\n        if (res && res.code === 200) {\r\n          window.location.href = localStorage.getItem('authPage')\r\n        }\r\n      }\r\n    })\r\n  } else {\r\n    phoneFormRef.value.validate(valid => {\r\n      if (valid) {\r\n        console.log(phoneForm.value, 'phone')\r\n      }\r\n    })\r\n  }\r\n}\r\nconst handleFoget = () => {\r\n\r\n}\r\nconst qrLoading = ref(false)\r\nconst loginWay = ref('form')\r\nconst handleWechat = async () => {\r\n  loginWay.value = 'qrcode'\r\n  qrLoading.value = true\r\n  const res = await getCodeRender()\r\n  if(res.code === 200) {\r\n    let option = {\r\n      id: 'qr_code',\r\n      appid: res.data.appId,  // 微信分配的应用ID\r\n      agentid: res.data.agentId,  // 微信开放平台分配的移动应用的appid\r\n      redirect_uri: res.data.redirectUri, // 授权后重定向的回调链接地址\r\n      state:  res.data.state,  // 用于保持请求和回调的状态，这个参数一般用于防止CSRF攻击，可不传\r\n      scope: res.data.scope\r\n    }\r\n    new WwLogin(option)\r\n    qrLoading.value = false\r\n  }\r\n}\r\nconst handleRegister = () => {\r\n  router.push('/login/register')\r\n}\r\nconst handleGetCode = () => {\r\n  if (!/^1[3456789]\\d{9}$/.test(phoneForm.value.phone)) {\r\n    ElMessage.error('请输入正确的手机号')\r\n    return\r\n  }\r\n  if (countdown.value === 0) {\r\n    startCountdown()\r\n  }\r\n}\r\nonBeforeMount(async () => {\r\n  let authPage = route.query.authorizationUri + '?client_id=' + route.query.client_id + '&response_type=' + route.query.response_type + '&redirect_uri=' + route.query.redirect_uri\r\n  localStorage.setItem('authPage', authPage)\r\n  // 企业微信内部应用登录\r\n  let ua = window.navigator.userAgent.toLowerCase()\r\n  if (ua.match(/wxwork/i)) {\r\n    let res = await getNativeBaseUrl()\r\n    if (res.code === 200) {\r\n      window.location.href = res.data\r\n      return\r\n    }\r\n  }\r\n  // 外部登录\r\n  let res = await isLogin()\r\n  if (res.data) {\r\n    if (route.query.scope) {\r\n      authPage += '&scope=' + route.query.scope\r\n      localStorage.setItem('authPage', authPage)\r\n    }\r\n    window.location.href = authPage\r\n  }\r\n  loading.value = false\r\n  getPicCaptcha()\r\n})\r\nonBeforeUnmount(() => {\r\n  clearInterval(timer.value)\r\n})\r\n</script>\r\n\r\n<style lang='scss' scoped>\r\n.login-home{\r\n    display: flex;\r\n    justify-content: center;\r\n    padding-top: 80px;\r\n    .login-box{\r\n        width: 562px;\r\n        .login-header{\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            margin-bottom: 40px;\r\n            img{\r\n                margin-bottom: 20px;\r\n                width: 5rem;\r\n                border-radius: 50%;\r\n            }\r\n            .title{\r\n                font-size: 24px;\r\n            }\r\n        }\r\n        .login-body{\r\n          position: relative;\r\n          padding: 100px 80px 60px;\r\n          border: 1px solid #e6e6e6;\r\n          border-radius: 10px;\r\n          box-shadow: 0 4px 24px rgba(128,128,128,0.1);\r\n          .login-form{\r\n              .form-body {\r\n                  .tab-label{\r\n                      font-size: 16px;\r\n                      width: 180px;\r\n                      text-align: center;\r\n                      i{\r\n                          font-size: 18px;\r\n                      }\r\n                  }\r\n                  ::v-deep .form-code .el-form-item__content{\r\n                      display: flex;\r\n                      flex-wrap: nowrap;\r\n                      justify-content: space-between;\r\n                      align-items: center;\r\n                      & > .el-button{\r\n                          margin-left: 10px;\r\n                          min-width: 140px;\r\n                      }\r\n                  }\r\n              }\r\n              .form-btn{\r\n                  margin-bottom: 20px;\r\n                  .el-button{\r\n                      width: 100%;\r\n                  }\r\n              }\r\n              .form-footer{\r\n                  display: flex;\r\n                  justify-content: space-between;\r\n              }\r\n          }\r\n          .login-qrcode{\r\n              display: flex;\r\n              justify-content: center;\r\n          }\r\n          .change-way-btn{\r\n            position: absolute;\r\n            top: 10px;right: 10px;\r\n            height: 60px;width: 60px;\r\n            cursor: pointer;\r\n            user-select: none;\r\n            i{\r\n              font-size: 60px;\r\n              color: #4D99F2;\r\n            }\r\n          }\r\n        }\r\n    }\r\n}\r\n.login-footer{\r\n  position: fixed;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex-wrap: nowrap;\r\n  bottom: 0;\r\n  padding: 18px 0;\r\n  width: 100%;\r\n  border-top: 1px solid #e3e4e6;\r\n  background: #ffffff;\r\n  .copyright{\r\n    display: flex;\r\n    justify-content: center;\r\n    padding: 5px 0;\r\n    font-size: 12px;\r\n    color: #666666;\r\n  }\r\n}\r\n::v-deep .captcha .el-form-item__content{\r\n    display: flex;\r\n    flex-wrap: nowrap;\r\n    .captcha-item{\r\n      margin-left: 20px;\r\n      height: 34px;\r\n      border-radius: 2px;\r\n    }\r\n}\r\n</style>","import script from \"./LoginHome.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./LoginHome.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./LoginHome.vue?vue&type=style&index=0&id=15d511d8&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-15d511d8\"]])\n\nexport default __exports__"],"names":["router","useRouter","route","useRoute","activeName","ref","loading","picCaptchaValid","rule","value","callback","Error","verifyCaptcha","code","then","res","userFormRef","userFormRules","reactive","name","required","message","trigger","pwd","captcha","validator","userForm","phoneFormRef","phoneValid","test","phoneFormRules","phone","phoneForm","countdown","timer","startCountdown","setInterval","clearInterval","picCaptcha","getPicCaptcha","async","generateCaptcha","data","handleLogin","validate","valid","doLogin","window","location","href","localStorage","getItem","console","log","handleFoget","qrLoading","loginWay","handleWechat","getCodeRender","option","id","appid","appId","agentid","agentId","redirect_uri","redirectUri","state","scope","WwLogin","handleRegister","push","handleGetCode","ElMessage","error","onBeforeMount","authPage","query","authorizationUri","client_id","response_type","setItem","ua","navigator","userAgent","toLowerCase","match","getNativeBaseUrl","isLogin","onBeforeUnmount","__exports__"],"sourceRoot":""}